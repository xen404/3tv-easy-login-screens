import 'intersection-observer'
import yall from 'yall-js'

if (window.yall === undefined) {
  window.yall = yall
  document.addEventListener('DOMContentLoaded', function () {
    yall({
      observeChanges: true,
      threshold: 300
    })
  })
}

// TODO: rewrite code below using Intersection Observer API
/* Searched elements with the class animation and adds the class in-view when in viewport to trigger animation */
document.addEventListener('DOMContentLoaded', function () {
  const animationElements = document.querySelectorAll('.animation')

  function checkIfInView () {
    const windowHeight = window.innerHeight
    const windowTopPosition = window.pageYOffset
    const windowBottomPosition = (windowTopPosition + windowHeight)

    for (let i = 0, len = animationElements.length; i < len; i++) {
      const elementCurrent = animationElements[i]
      const elementHeight = elementCurrent.offsetHeight
      const elementTopPosition = elementCurrent.getBoundingClientRect().top + window.pageYOffset
      const elementBottomPosition = (elementTopPosition + elementHeight)

      if ((elementBottomPosition >= windowTopPosition) && (elementTopPosition <= windowBottomPosition)) {
        elementCurrent.classList.add('in-view')
      } else {
        elementCurrent.classList.remove('in-view')
      }
    }
  }
  checkIfInView()

  window.addEventListener('scroll', checkIfInView)
  window.addEventListener('resize', checkIfInView)
})
